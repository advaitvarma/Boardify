<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AstraScore</title>
    
    <!-- ==================================================================================
         EXTERNAL LIBRARIES
         1. Tailwind CSS (Styling Framework)
         2. FontAwesome (Icons)
         3. Google Fonts (Outfit Font)
    ================================================================================== -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- ==================================================================================
         TAILWIND CONFIGURATION
         - Defines custom colors matching your design images
         - Defines custom animations (float, shine, fade-in)
    ================================================================================== -->
    <script>
        tailwind.config = { 
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        // Custom Brand Colors
                        brand: {
                            orange: '#FF8A00', // Sports
                            blue: '#4876FF',   // Academic
                            pink: '#FF4D8D',   // Cultural
                            purple: '#8B5CF6', // Esports
                            slate: '#64748b',  // Default/Other
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'fade-in-up': 'fadeInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shine': 'shine 3s infinite',
                        'bounce-slight': 'bounceSlight 2s infinite',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        shine: {
                            '0%': { backgroundPosition: '200% center' },
                            '100%': { backgroundPosition: '-200% center' },
                        },
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- ==================================================================================
         CUSTOM CSS STYLES
         - Glassmorphism effects
         - Custom scrollbars
         - Specific gradient definitions for categories
    ================================================================================== -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Animated Background Blobs --- */
        .blob {
            position: fixed;
            filter: blur(80px);
            z-index: -1;
            animation: float 10s ease-in-out infinite;
            pointer-events: none;
            transition: all 0.5s ease;
        }
        
        .blob-1 { 
            top: -10%; left: -10%; width: 600px; height: 600px; 
            background: radial-gradient(circle, #c084fc 0%, rgba(192,132,252,0) 70%);
            opacity: 0.35; 
            animation-delay: 0s; 
        }
        .blob-2 { 
            bottom: -10%; right: -10%; width: 600px; height: 600px; 
            background: radial-gradient(circle, #60a5fa 0%, rgba(96,165,250,0) 70%);
            opacity: 0.35; 
            animation-delay: -5s; 
        }
        .blob-3 { 
            top: 40%; left: 40%; width: 400px; height: 400px; 
            background: radial-gradient(circle, #f472b6 0%, rgba(244,114,182,0) 70%);
            opacity: 0.3; 
            animation-delay: -2s; 
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb { background-color: #475569; }

        /* --- Glassmorphism & Card Styles --- */
        
        /* Light Mode Glass */
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 
                0 10px 40px -10px rgba(0,0,0,0.08),
                0 0 20px rgba(255, 255, 255, 0.5) inset;
        }
        
        /* Dark Mode Glass */
        .dark .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        /* --- Interactive Event Card --- */
        .event-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
            isolation: isolate;
        }
        
        .event-card:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: 
                0 20px 30px -10px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(99, 102, 241, 0.1);
            z-index: 10;
        }
        
        .event-card:hover .card-icon-container {
            transform: scale(1.1) rotate(6deg);
        }

        /* Shine Effect Overlay */
        .event-card::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-25deg);
            transition: 0.5s;
            pointer-events: none;
            z-index: 2;
        }
        .event-card:hover::before {
            left: 150%;
            transition: 0.7s;
        }
        .dark .event-card::before {
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.05), transparent);
        }

        /* --- Modal Overlay --- */
        .modal-overlay {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            transition: opacity 0.3s ease;
        }
        
        /* --- Custom Inputs --- */
        .custom-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            appearance: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- Toggle Switch Styles --- */
        .toggle-btn { transition: all 0.3s ease; position: relative; overflow: hidden; }
        .toggle-active {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            border-color: transparent;
        }
        .toggle-inactive {
            background: transparent;
            color: #64748b;
        }
        .dark .toggle-inactive { color: #94a3b8; }
        .toggle-inactive:hover { background: rgba(0,0,0,0.05); }
        .dark .toggle-inactive:hover { background: rgba(255,255,255,0.05); }
        
        /* --- Stat Tiles Active State --- */
        .stat-card-active {
            transform: scale(1.03);
            border-width: 0 0 0 4px !important; 
        }
        
        /* --- Specific Category Gradients --- */
        .gradient-sports { background: linear-gradient(135deg, #FF8A00 0%, #FF5F00 100%); }
        .gradient-academic { background: linear-gradient(135deg, #4876FF 0%, #2563EB 100%); }
        .gradient-cultural { background: linear-gradient(135deg, #FF4D8D 0%, #E11D48 100%); }
        .gradient-esports { background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
        .gradient-other { background: linear-gradient(135deg, #64748b 0%, #475569 100%); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-white transition-colors duration-300 min-h-screen relative font-sans selection:bg-indigo-500 selection:text-white">

    <!-- ==================================================================================
         BACKGROUND DECORATION
    ================================================================================== -->
    <div class="blob blob-1 rounded-full mix-blend-multiply dark:mix-blend-screen"></div>
    <div class="blob blob-2 rounded-full mix-blend-multiply dark:mix-blend-screen"></div>
    <div class="blob blob-3 rounded-full mix-blend-multiply dark:mix-blend-screen"></div>

    <!-- ==================================================================================
         NAVIGATION BAR
    ================================================================================== -->
    <nav class="sticky top-0 z-40 glass-card border-b border-white/50 dark:border-slate-700/50 shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center">
            
            <!-- Logo Section -->
            <a href="index.html" class="group flex items-center gap-3 no-underline">
                <div class="relative w-10 h-10">
                    <div class="absolute inset-0 bg-blue-600 rounded-xl rotate-3 group-hover:rotate-6 transition-transform opacity-20"></div>
                    <div class="relative w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/30 group-hover:scale-105 transition-transform duration-200">
                        <i class="fas fa-star text-sm"></i>
                    </div>
                </div>
                <div class="flex flex-col">
                    <span class="text-xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-indigo-700 dark:from-blue-400 dark:to-indigo-400">
                        AstraScore
                    </span>
                    <span class="text-[0.65rem] font-bold text-slate-500 dark:text-slate-400 tracking-widest uppercase -mt-1">Dashboard</span>
                </div>
            </a>
            
            <!-- Desktop Controls -->
            <div class="flex items-center gap-3 md:gap-4">
                <a href="create.html" class="hidden md:flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white px-5 py-2.5 rounded-xl font-bold text-sm transition-all shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 hover:-translate-y-0.5 active:translate-y-0 active:shadow-sm">
                    <i class="fas fa-plus"></i>
                    <span>New Event</span>
                </a>
                
                <!-- Theme Toggle Button -->
                <button id="theme-toggle" class="w-10 h-10 rounded-xl glass-card flex items-center justify-center text-slate-600 dark:text-slate-300 hover:bg-white dark:hover:bg-slate-800 transition-all shadow-sm hover:shadow-md border border-slate-200 dark:border-slate-700 group">
                    <i class="fas fa-sun text-yellow-500 group-hover:rotate-90 transition-transform duration-500"></i>
                </button>
                
                <!-- User Avatar (Mock) -->
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-700 dark:to-slate-800 flex items-center justify-center border border-white/50 dark:border-slate-600/50 cursor-pointer hover:ring-2 hover:ring-offset-2 hover:ring-blue-500 dark:hover:ring-offset-slate-900 transition-all">
                    <i class="fas fa-user text-slate-500 dark:text-slate-400"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- ==================================================================================
         MAIN CONTENT AREA
    ================================================================================== -->
    <main class="container mx-auto px-4 md:px-6 py-8 min-h-[calc(100vh-80px)]">
        
        <!-- Header & Greeting -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6 animate-fade-in-up">
            <div>
                <h1 class="text-4xl md:text-5xl font-black tracking-tight mb-2 text-slate-800 dark:text-white drop-shadow-sm">
                    Dashboard
                </h1>
                <p class="text-slate-500 dark:text-slate-400 font-medium text-lg max-w-lg">
                    Manage your events, track live scores, and customize your tournaments all in one place.
                </p>
            </div>
            
            <!-- View Mode Toggle Switch -->
            <div class="glass-card p-1.5 rounded-2xl flex items-center gap-1 border border-slate-200 dark:border-slate-700 shadow-sm backdrop-blur-xl">
                <button onclick="toggleViewMode('events')" id="btn-view-events" class="toggle-btn px-6 py-3 rounded-xl font-bold text-sm flex items-center gap-2 toggle-active">
                    <i class="fas fa-gamepad"></i> Single Events
                </button>
                <button onclick="toggleViewMode('festivals')" id="btn-view-festivals" class="toggle-btn px-6 py-3 rounded-xl font-bold text-sm flex items-center gap-2 toggle-inactive">
                    <i class="fas fa-icons"></i> Festivals
                </button>
            </div>
        </div>

        <!-- 
            STATISTICS TILES (Interactive Filters)
            Each tile is clickable and acts as a filter for the grid below.
        -->
        <div id="stats-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-12">
            <!-- Loading Skeletons (replaced by JS) -->
            <div class="glass-card h-28 rounded-2xl animate-pulse bg-slate-200/50 dark:bg-slate-800/50"></div>
            <div class="glass-card h-28 rounded-2xl animate-pulse bg-slate-200/50 dark:bg-slate-800/50 delay-75"></div>
            <div class="glass-card h-28 rounded-2xl animate-pulse bg-slate-200/50 dark:bg-slate-800/50 delay-100"></div>
            <div class="glass-card h-28 rounded-2xl animate-pulse bg-slate-200/50 dark:bg-slate-800/50 delay-150"></div>
        </div>

        <!-- 
            CONTROL BAR
            Contains Search, Status Dropdown, and Category Pills
        -->
        <div class="glass-card p-3 rounded-2xl flex flex-col lg:flex-row gap-3 mb-8 shadow-sm animate-fade-in-up border border-white/60 dark:border-white/5 items-center backdrop-blur-xl sticky top-24 z-30" style="animation-delay: 0.1s;">
            
            <!-- Search Input -->
            <div class="relative flex-grow w-full lg:w-auto group z-10">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i class="fas fa-search text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                </div>
                <input type="text" id="search-input" placeholder="Search events..." 
                    class="w-full pl-11 pr-4 py-3.5 rounded-xl bg-slate-50/80 dark:bg-slate-800/50 border border-transparent focus:bg-white dark:focus:bg-slate-800 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-slate-700 dark:text-white placeholder-slate-400 font-medium shadow-inner">
            </div>

            <!-- Status Filter Dropdown (Synced with Tiles) -->
            <div class="relative w-full lg:w-48 z-10">
                <select id="status-filter" onchange="handleStatusChange(this.value)" class="custom-select w-full px-4 py-3.5 rounded-xl bg-slate-50/80 dark:bg-slate-800/50 border border-transparent focus:bg-white dark:focus:bg-slate-800 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-slate-700 dark:text-white font-bold text-sm cursor-pointer shadow-sm hover:bg-white dark:hover:bg-slate-800">
                    <option value="all">All Statuses</option>
                    <option value="live">âš¡ Live Now</option>
                    <option value="upcoming">ðŸ“… Upcoming</option>
                    <option value="completed">âœ… Completed</option>
                </select>
            </div>
            
            <!-- Category Filter Pills (Horizontal Scroll on Mobile) -->
            <div class="flex gap-2 overflow-x-auto w-full lg:w-auto pb-2 lg:pb-0 no-scrollbar items-center pl-1" id="category-pills">
                <!-- Pills populated by JS -->
            </div>
        </div>

        <!-- 
            EVENTS GRID
            The main display area for event cards.
        -->
        <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20 min-h-[300px]">
            <!-- Events populated by JS -->
        </div>

        <!-- 
            EMPTY STATE
            Shown when no events match filters.
        -->
        <div id="empty-state" class="hidden flex-col items-center justify-center py-24 text-center animate-fade-in-up">
            <div class="relative mb-6">
                <div class="absolute inset-0 bg-blue-500 blur-2xl opacity-20 rounded-full"></div>
                <div class="relative w-28 h-28 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-5xl text-slate-300 dark:text-slate-600 shadow-xl border border-slate-100 dark:border-slate-700">
                    <i class="fas fa-search-minus"></i>
                </div>
            </div>
            <h3 class="text-2xl font-bold text-slate-800 dark:text-white mb-3">No items found</h3>
            <p class="text-slate-500 dark:text-slate-400 max-w-sm mx-auto leading-relaxed">
                We couldn't find any matches based on your current filters or search query.
            </p>
            <button onclick="resetFilters()" class="mt-8 px-6 py-3 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-white rounded-xl font-bold hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors flex items-center gap-2">
                <i class="fas fa-times-circle"></i> Clear Filters
            </button>
        </div>

    </main>

    <!-- 
        MOBILE FLOATING ACTION BUTTON
    -->
    <a href="create.html" class="md:hidden fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full shadow-lg shadow-blue-600/40 flex items-center justify-center text-2xl z-40 hover:scale-110 active:scale-95 transition-all">
        <i class="fas fa-plus"></i>
    </a>

    <!-- 
        CUSTOM DELETE CONFIRMATION MODAL
    -->
    <div id="delete-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 modal-overlay opacity-0" id="modal-backdrop" onclick="closeDeleteModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative w-full max-w-sm bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 transform scale-90 opacity-0 transition-all duration-300" id="modal-content">
            <div class="w-16 h-16 rounded-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-500 flex items-center justify-center text-2xl mx-auto mb-4 border-4 border-red-50 dark:border-red-900/10 animate-bounce-slight">
                <i class="fas fa-trash-alt"></i>
            </div>
            
            <h3 class="text-xl font-black text-center text-slate-800 dark:text-white mb-2">Delete Event?</h3>
            <p class="text-center text-slate-500 dark:text-slate-400 text-sm mb-6 leading-relaxed">
                Are you sure you want to remove <span id="modal-event-name" class="font-bold text-slate-700 dark:text-slate-300">this event</span>? This action cannot be undone and all data will be lost.
            </p>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="closeDeleteModal()" class="py-3 px-4 rounded-xl font-bold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                    Cancel
                </button>
                <button onclick="confirmDelete()" class="py-3 px-4 rounded-xl font-bold text-white bg-red-500 hover:bg-red-600 shadow-lg shadow-red-500/30 transition-all hover:-translate-y-0.5">
                    Delete It
                </button>
            </div>
        </div>
    </div>

    <!-- 
        STATUS CHANGE MODAL (Added Feature)
    -->
    <div id="status-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 modal-overlay opacity-0" id="status-modal-backdrop" onclick="closeStatusModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative w-full max-w-sm bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 transform scale-90 opacity-0 transition-all duration-300" id="status-modal-content">
            <h3 class="text-xl font-black text-center text-slate-800 dark:text-white mb-6">Update Event Status</h3>
            <div class="space-y-3">
                <button onclick="updateStatus('upcoming')" class="w-full py-4 rounded-xl font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-all flex items-center justify-center gap-3">
                    <i class="fas fa-calendar-alt"></i> Upcoming
                </button>
                <button onclick="updateStatus('live')" class="w-full py-4 rounded-xl font-bold text-red-600 bg-red-50 hover:bg-red-100 border border-red-200 transition-all flex items-center justify-center gap-3">
                    <i class="fas fa-bolt"></i> Live Now
                </button>
                <button onclick="updateStatus('completed')" class="w-full py-4 rounded-xl font-bold text-emerald-600 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 transition-all flex items-center justify-center gap-3">
                    <i class="fas fa-check-circle"></i> Completed
                </button>
            </div>
            <button onclick="closeStatusModal()" class="mt-6 w-full py-3 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 font-bold text-sm transition-colors">Cancel</button>
        </div>
    </div>

    <!-- ==================================================================================
         JAVASCRIPT LOGIC
    ================================================================================== -->
    <script>
        /**
         * ASTRASCORE DASHBOARD LOGIC (COMPLETE)
         * Table of Contents:
         * 1. State & Configuration
         * 2. Initialization & Theme
         * 3. View Mode Switching (Single vs Festival)
         * 4. Data Loading & Persistence
         * 5. Rendering Logic (Cards, Stats, Filters)
         * 6. Interaction Handlers (Delete, Status, Search)
         */

        // ---------------------------------------------------------
        // 1. STATE & CONFIGURATION
        // ---------------------------------------------------------
        let viewMode = 'events'; // 'events' or 'festivals'
        let events = []; // Stores Single Events
        let festivals = []; // Stores Festivals
        
        let currentFilter = 'all'; // Category filter
        let currentStatusFilter = 'all'; // Status filter
        let searchQuery = '';
        
        let eventToDeleteId = null;
        let eventToEditStatusId = null; 

        // Style configuration
        const styles = {
            orange: { hex: "#FF8A00", gradient: "bg-gradient-to-br from-orange-400 to-red-500", text: "text-orange-600", lightBg: "bg-orange-50", shadow: "shadow-orange-500/20" },
            blue: { hex: "#4876FF", gradient: "bg-gradient-to-br from-blue-400 to-indigo-500", text: "text-blue-600", lightBg: "bg-blue-50", shadow: "shadow-blue-500/20" },
            emerald: { hex: "#10b981", gradient: "bg-gradient-to-br from-emerald-400 to-teal-500", text: "text-emerald-600", lightBg: "bg-emerald-50", shadow: "shadow-emerald-500/20" },
            purple: { hex: "#8B5CF6", gradient: "bg-gradient-to-br from-purple-400 to-fuchsia-500", text: "text-purple-600", lightBg: "bg-purple-50", shadow: "shadow-purple-500/20" },
            rose: { hex: "#FF4D8D", gradient: "bg-gradient-to-br from-rose-400 to-pink-500", text: "text-rose-600", lightBg: "bg-rose-50", shadow: "shadow-rose-500/20" },
            red: { hex: "#ef4444", gradient: "bg-gradient-to-br from-red-500 to-rose-600", text: "text-red-600", lightBg: "bg-red-50", shadow: "shadow-red-500/20" },
            slate: { hex: "#64748b", gradient: "bg-gradient-to-br from-slate-500 to-slate-600", text: "text-slate-600", lightBg: "bg-slate-50", shadow: "shadow-slate-500/20" }
        };

        const categoryConfig = {
            'sports': { icon: 'fa-trophy', colorName: 'orange', gradientClass: 'gradient-sports', hex: '#FF8A00' },
            'academic': { icon: 'fa-graduation-cap', colorName: 'blue', gradientClass: 'gradient-academic', hex: '#4876FF' },
            'cultural': { icon: 'fa-theater-masks', colorName: 'rose', gradientClass: 'gradient-cultural', hex: '#FF4D8D' },
            'esports': { icon: 'fa-headset', colorName: 'purple', gradientClass: 'gradient-esports', hex: '#8B5CF6' },
            'other': { icon: 'fa-star', colorName: 'slate', gradientClass: 'gradient-other', hex: '#64748b' }
        };


        // ---------------------------------------------------------
        // 2. INITIALIZATION & THEME
        // ---------------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initTheme();
            toggleViewMode('events'); // Default View
        });

        function initTheme() {
            const themeBtn = document.getElementById('theme-toggle');
            const html = document.documentElement;
            const icon = themeBtn ? themeBtn.querySelector('i') : null;

            // Check Preference
            if (localStorage.getItem('astra_theme') === 'dark' || (!localStorage.getItem('astra_theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                html.classList.add('dark');
                if(icon) icon.className = 'fas fa-moon text-blue-300';
            }

            if(themeBtn) {
                themeBtn.addEventListener('click', () => {
                    html.classList.toggle('dark');
                    const isDark = html.classList.contains('dark');
                    localStorage.setItem('astra_theme', isDark ? 'dark' : 'light');
                    if(icon) icon.className = isDark ? 'fas fa-moon text-blue-300' : 'fas fa-sun text-yellow-500';
                });
            }
        }


        // ---------------------------------------------------------
        // 3. VIEW MODE TOGGLING
        // ---------------------------------------------------------
        window.toggleViewMode = function(mode) {
            viewMode = mode;
            
            const btnEvents = document.getElementById('btn-view-events');
            const btnFestivals = document.getElementById('btn-view-festivals');
            const catPills = document.getElementById('category-pills');

            // 1. Toggle Button Visuals
            if (mode === 'events') {
                btnEvents.classList.add('toggle-active');
                btnEvents.classList.remove('toggle-inactive');
                btnFestivals.classList.add('toggle-inactive');
                btnFestivals.classList.remove('toggle-active');
                
                // Show category filters only for events
                if(catPills) catPills.classList.remove('hidden');
            } else {
                btnFestivals.classList.add('toggle-active');
                btnFestivals.classList.remove('toggle-inactive');
                btnEvents.classList.add('toggle-inactive');
                btnEvents.classList.remove('toggle-active');
                
                // Hide category filters for festivals (simplified view)
                if(catPills) catPills.classList.add('hidden');
            }

            // 2. Reset Filters slightly to avoid confusion
            currentStatusFilter = 'all';
            document.getElementById('status-filter').value = 'all';
            
            // 3. Re-render Everything
            renderStats();
            renderFilters(); 
            renderContent();
        }


        // ---------------------------------------------------------
        // 4. DATA LOADING & PERSISTENCE
        // ---------------------------------------------------------
        function loadData() {
            try {
                // Load Single Events
                const storedEvents = localStorage.getItem('astra_events');
                if (storedEvents) {
                    const rawData = JSON.parse(storedEvents);
                    events = rawData.map(e => ({
                        id: e.id,
                        title: e.name || e.title || "Untitled Event",
                        category: (e.category || "other").toLowerCase(),
                        subCategory: e.subcategory || e.subCategory || "General",
                        type: e.scale || e.type || "Local",
                        status: e.status || "upcoming",
                        date: e.date || new Date().toISOString(),
                        viewLink: `board.html?id=${e.id}`,
                        adminLink: `admin.html?id=${e.id}`
                    }));
                } else {
                    events = generateMockEvents(); // Fallback
                    localStorage.setItem('astra_events', JSON.stringify(events));
                }

                // Load Festivals
                const storedFestivals = localStorage.getItem('astra_festivals');
                festivals = storedFestivals ? JSON.parse(storedFestivals) : [];
                
            } catch (err) {
                console.error("Error loading data:", err);
                events = [];
                festivals = [];
            }
        }

        function generateMockEvents() {
            return [
                { id: 'evt-001', name: "Inter-High Football Final", category: "sports", subcategory: "Football", scale: "Inter-school", status: "live" },
                { id: 'evt-002', name: "Science Wizard 2025", category: "academic", subcategory: "Quiz", scale: "City Level", status: "upcoming" }
            ];
        }

        function saveEvents() {
            // Saves current SINGLE events state back to local storage
            // Note: We are not implementing full CRUD for festivals here, just read-only/link
            localStorage.setItem('astra_events', JSON.stringify(events.map(e => ({
                id: e.id,
                name: e.title,
                category: e.category,
                subcategory: e.subCategory,
                scale: e.type,
                status: e.status,
                date: e.date
            }))));
        }


        // ---------------------------------------------------------
        // 5. RENDERING LOGIC
        // ---------------------------------------------------------

        /**
         * renderStats: Renders the top tiles based on ACTIVE VIEW MODE.
         */
        function renderStats() {
            const container = document.getElementById('stats-container');
            if(!container) return;

            // Choose dataset based on view mode
            const dataSet = viewMode === 'events' ? events : festivals;

            const total = dataSet.length;
            const live = dataSet.filter(e => e.status === 'live' || e.status === 'ongoing').length;
            const upcoming = dataSet.filter(e => e.status === 'upcoming').length;
            const completed = dataSet.filter(e => e.status === 'completed').length;

            const statItems = [
                { label: 'Total Items', val: total, icon: viewMode === 'events' ? 'fa-layer-group' : 'fa-icons', color: 'blue', filterKey: 'all', hex: styles.blue.hex },
                { label: 'Live Now', val: live, icon: 'fa-bolt', color: 'red', filterKey: 'live', hex: styles.red.hex },
                { label: 'Upcoming', val: upcoming, icon: 'fa-calendar-alt', color: 'orange', filterKey: 'upcoming', hex: styles.orange.hex },
                { label: 'Completed', val: completed, icon: 'fa-check-double', color: 'emerald', filterKey: 'completed', hex: styles.emerald.hex },
            ];

            container.innerHTML = statItems.map((stat, i) => {
                const s = styles[stat.color];
                const isActive = currentStatusFilter === stat.filterKey;
                
                const activeClasses = isActive 
                    ? `stat-card-active ring-1 ring-${stat.color}-200 dark:ring-${stat.color}-900 bg-${stat.color}-50 dark:bg-${stat.color}-900/10` 
                    : `hover:bg-white/80 dark:hover:bg-slate-800/80 opacity-90 hover:opacity-100`;

                return `
                <div onclick="handleStatusChange('${stat.filterKey}')"
                     class="glass-card p-5 rounded-2xl flex items-center gap-5 animate-fade-in-up transition-all duration-300 cursor-pointer border-l-4 group relative overflow-hidden ${activeClasses}" 
                     style="animation-delay: ${i * 0.1}s; border-left-color: ${stat.hex};">
                    
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 dark:via-white/5 to-transparent -translate-x-full group-hover:animate-shine z-0 pointer-events-none"></div>

                    <div class="relative z-10 w-12 h-12 rounded-2xl ${s.gradient} text-white flex items-center justify-center text-lg shadow-lg ${s.shadow} group-hover:scale-110 transition-transform duration-300">
                        <i class="fas ${stat.icon}"></i>
                    </div>

                    <div class="relative z-10">
                        <p class="text-xs font-bold ${s.text} uppercase tracking-widest mb-1 opacity-90 group-hover:opacity-100 transition-opacity">
                            ${stat.label}
                        </p>
                        <p class="text-3xl font-black text-slate-800 dark:text-white leading-none group-hover:scale-105 origin-left transition-transform">
                            ${stat.val}
                        </p>
                    </div>
                    
                    ${isActive ? `<div class="absolute top-3 right-3 text-${stat.color}-500 opacity-100 transition-opacity"><i class="fas fa-check-circle"></i></div>` : ''}
                </div>`;
            }).join('');
        }

        function renderFilters() {
            // Only show category filters for Single Events mode
            if(viewMode === 'festivals') return;

            const container = document.getElementById('category-pills');
            if(!container) return;
            const cats = ['all', 'sports', 'academic', 'cultural', 'esports', 'other'];
            
            container.innerHTML = cats.map(cat => {
                const isActive = currentFilter === cat;
                const catConfig = categoryConfig[cat] || categoryConfig['other'];
                
                let activeStyle = '';
                if(isActive && cat !== 'all') {
                   activeStyle = `background: ${catConfig.hex}; color: white; border-color: transparent; box-shadow: 0 4px 10px -2px ${catConfig.hex}66;`;
                } else if (isActive && cat === 'all') {
                   activeStyle = `background: #1e293b; color: white; border-color: transparent;`; 
                }

                const baseClasses = "px-6 py-2.5 rounded-xl text-sm font-bold transition-all whitespace-nowrap relative overflow-hidden group border";
                const inactiveClasses = "bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700 border-slate-200 dark:border-slate-700";

                return `
                <button onclick="setFilter('${cat}')" 
                    class="${baseClasses} ${isActive ? 'scale-105 shadow-lg' : inactiveClasses}"
                    style="${isActive ? activeStyle : ''}">
                    ${isActive ? '<div class="absolute inset-0 bg-white/20 skew-x-12 -translate-x-full animate-shine"></div>' : ''}
                    <span class="relative z-10 flex items-center gap-2">
                        ${isActive ? '<i class="fas fa-check text-xs"></i>' : (cat !== 'all' ? `<i class="fas ${catConfig.icon} text-xs opacity-70"></i>` : '')}
                        ${cat.charAt(0).toUpperCase() + cat.slice(1)}
                    </span>
                </button>
            `}).join('');
        }

        /**
         * renderContent: Decides whether to render Single Cards or Festival Cards.
         */
        function renderContent() {
            const grid = document.getElementById('events-grid');
            const empty = document.getElementById('empty-state');
            if(!grid || !empty) return;

            grid.innerHTML = '';

            let itemsToRender = [];

            if (viewMode === 'events') {
                // Filter Single Events
                itemsToRender = events.filter(e => {
                    const searchMatch = (e.title || '').toLowerCase().includes(searchQuery.toLowerCase()) || 
                                        (e.subCategory || '').toLowerCase().includes(searchQuery.toLowerCase());
                    const categoryMatch = currentFilter === 'all' || e.category === currentFilter;
                    
                    let statusMatch = true;
                    if (currentStatusFilter !== 'all') {
                        if (currentStatusFilter === 'live') statusMatch = (e.status === 'live' || e.status === 'ongoing');
                        else statusMatch = e.status === currentStatusFilter;
                    }
                    return searchMatch && categoryMatch && statusMatch;
                });
            } else {
                // Filter Festivals
                itemsToRender = festivals.filter(f => {
                    const searchMatch = (f.name || '').toLowerCase().includes(searchQuery.toLowerCase());
                    // Festivals typically don't have the same "Category" field, so we skip category filter
                    let statusMatch = true;
                    if (currentStatusFilter !== 'all') {
                         statusMatch = f.status === currentStatusFilter;
                    }
                    return searchMatch && statusMatch;
                });
            }

            // Empty State
            if(itemsToRender.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                empty.classList.add('flex');
                return;
            }

            grid.classList.remove('hidden');
            empty.classList.add('hidden');
            empty.classList.remove('flex');

            // Render Loop
            itemsToRender.forEach((item, i) => {
                const cardHTML = viewMode === 'events' 
                    ? getSingleEventCardHTML(item, i) 
                    : getFestivalCardHTML(item, i);
                
                const div = document.createElement('div');
                div.innerHTML = cardHTML;
                // Unwrap the div to append the card directly to grid
                grid.appendChild(div.firstElementChild);
            });
        }

        // --- HTML GENERATORS ---

        function getSingleEventCardHTML(e, i) {
            const catData = categoryConfig[e.category] || categoryConfig['other'];
            
            // Status Badge Logic
            let badge = '';
            const clickHandler = `onclick="event.stopPropagation(); openStatusModal('${e.id}')"`;
            const badgeBaseClasses = "flex items-center gap-1.5 text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-wide cursor-pointer hover:scale-105 active:scale-95 transition-transform z-20";

            if(e.status === 'live' || e.status === 'ongoing') {
                badge = `<button ${clickHandler} class="${badgeBaseClasses} bg-red-500 text-white shadow-md shadow-red-500/30 hover:bg-red-600">
                            <span class="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></span>Live
                         </button>`;
            } else if(e.status === 'upcoming') {
                badge = `<button ${clickHandler} class="${badgeBaseClasses} bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-300 border border-blue-200 dark:border-blue-700/50 hover:bg-blue-200 dark:hover:bg-blue-900/60">
                            Upcoming
                         </button>`;
            } else {
                badge = `<button ${clickHandler} class="${badgeBaseClasses} bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600">
                            Ended
                         </button>`;
            }

            return `
            <div class="glass-card event-card rounded-3xl p-0 flex flex-col animate-fade-in-up group overflow-hidden border border-slate-100 dark:border-slate-700 h-full" style="animation-delay: ${i * 0.05}s">
                <div class="relative p-6 pb-2">
                    <div class="absolute top-0 right-0 w-32 h-32 opacity-10 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:scale-110 duration-500" style="background: ${catData.hex}"></div>
                    
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <div class="card-icon-container w-12 h-12 rounded-2xl ${catData.gradientClass} flex items-center justify-center text-white shadow-lg shadow-${catData.colorName}-500/20 transition-transform duration-500 ease-out">
                            <i class="fas ${catData.icon} text-lg"></i>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            ${badge}
                            <button onclick="openDeleteModal('${e.id}', '${(e.title || '').replace(/'/g, "\\'")}')" class="text-slate-300 hover:text-red-500 transition-colors p-1 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 duration-300">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="relative z-10">
                        <span class="inline-block text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-1 pl-0.5">
                            ${e.subCategory}
                        </span>
                        <h3 class="text-2xl font-black text-slate-800 dark:text-white leading-tight mb-2 group-hover:text-${catData.colorName}-600 dark:group-hover:text-${catData.colorName}-400 transition-colors line-clamp-2">
                            ${e.title}
                        </h3>
                        <p class="text-sm font-medium text-slate-500 dark:text-slate-400 flex items-center gap-2 mb-4">
                            <i class="fas fa-users text-xs opacity-70"></i> ${e.type}
                        </p>
                    </div>
                </div>

                <div class="h-px w-full bg-gradient-to-r from-transparent via-slate-200 dark:via-slate-700 to-transparent my-2"></div>

                <div class="p-4 pt-2 mt-auto grid grid-cols-2 gap-3">
                    <a href="${e.adminLink}" class="group/btn flex items-center justify-center gap-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 py-3 rounded-xl font-bold text-sm border border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all">
                        <i class="fas fa-cog text-slate-400 group-hover/btn:text-slate-600 dark:group-hover/btn:text-slate-200"></i> Admin
                    </a>
                    <a href="${e.viewLink}" class="flex items-center justify-center gap-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 py-3 rounded-xl font-bold text-sm shadow-md shadow-slate-900/10 dark:shadow-white/5 hover:transform hover:-translate-y-0.5 transition-all">
                        View <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>
            </div>`;
        }

        function getFestivalCardHTML(f, i) {
            // New CLEAN WHITE Festival Card Design based on request
            const statusColors = {
                live: 'bg-red-500 text-white',
                upcoming: 'bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300',
                completed: 'bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400'
            };
            const badgeClass = statusColors[f.status] || statusColors.upcoming;
            const badgeText = f.status === 'live' ? 'Live Now' : (f.status || 'Upcoming');

            return `
            <div class="glass-card event-card rounded-3xl p-6 flex flex-col h-full group border border-slate-100 dark:border-slate-700 relative overflow-hidden animate-fade-in-up" style="animation-delay: ${i*0.05}s">
                
                <!-- Subtle Gradient Decor -->
                <div class="absolute top-0 right-0 w-40 h-40 bg-purple-500/5 rounded-bl-[100px] -mr-8 -mt-8 pointer-events-none transition-transform group-hover:scale-110"></div>

                <div class="flex justify-between items-start mb-6 relative z-10">
                    <!-- Icon Box -->
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center text-white shadow-lg shadow-purple-500/20">
                        <i class="fas fa-calendar-star text-2xl"></i>
                    </div>
                    <!-- Status Pill -->
                    <div class="px-3 py-1.5 rounded-full text-[10px] font-black uppercase tracking-wide ${badgeClass}">
                        ${badgeText}
                    </div>
                </div>

                <div class="relative z-10 mb-8 flex-grow">
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">
                        FESTIVAL
                    </span>
                    <h3 class="text-3xl font-black text-slate-800 dark:text-white leading-tight mb-2 group-hover:text-purple-600 transition-colors">
                        ${f.name}
                    </h3>
                    <div class="flex flex-col gap-1 mt-3">
                        <p class="text-sm font-bold text-slate-500 dark:text-slate-400 flex items-center gap-2">
                            <i class="fas fa-building text-slate-300"></i> ${f.organizer || 'Organizer'}
                        </p>
                         <p class="text-sm font-bold text-slate-500 dark:text-slate-400 flex items-center gap-2">
                            <i class="fas fa-calendar text-slate-300"></i> ${f.dates || 'Dates TBD'}
                        </p>
                    </div>
                </div>

                <!-- Action Buttons (Specific for Festival) -->
                <div class="grid grid-cols-2 gap-3 mt-auto relative z-10">
                    <a href="festival-dashboard.html?id=${f.id}" class="flex items-center justify-center gap-2 py-3 rounded-xl font-bold text-sm border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition group/btn">
                        <i class="fas fa-tools text-slate-400 group-hover/btn:text-purple-500 transition-colors"></i> Admin
                    </a>
                    <a href="festival-public.html?id=${f.id}" class="flex items-center justify-center gap-2 py-3 rounded-xl font-bold text-sm bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md hover:-translate-y-0.5 transition">
                        View <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>`;
        }


        // ---------------------------------------------------------
        // 6. INTERACTION HANDLERS
        // ---------------------------------------------------------

        /* --- FILTERS --- */
        window.setFilter = function(cat) {
            currentFilter = cat;
            renderFilters();
            renderContent();
        }

        window.handleStatusChange = function(status) {
            currentStatusFilter = status;
            // Sync Dropdown
            const select = document.getElementById('status-filter');
            if(select) select.value = status;
            
            renderStats(); 
            renderContent(); 
        }

        window.resetFilters = function() {
            currentFilter = 'all';
            currentStatusFilter = 'all';
            searchQuery = '';
            
            const searchEl = document.getElementById('search-input');
            const statusEl = document.getElementById('status-filter');
            
            if(searchEl) searchEl.value = '';
            if(statusEl) statusEl.value = 'all';
            
            renderStats();
            renderFilters();
            renderContent();
        }

        /* --- DELETE MODAL --- */
        const modal = document.getElementById('delete-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalEventName = document.getElementById('modal-event-name');

        window.openDeleteModal = function(id, title) {
            eventToDeleteId = id;
            if(modalEventName) modalEventName.textContent = title;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('scale-90', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.closeDeleteModal = function() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-90', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                eventToDeleteId = null;
            }, 300);
        }

        window.confirmDelete = function() {
            if (eventToDeleteId) {
                events = events.filter(e => e.id !== eventToDeleteId);
                saveEvents(); 
                closeDeleteModal();
                renderContent();
                renderStats();
            }
        }

        /* --- STATUS CHANGE MODAL --- */
        const statusModal = document.getElementById('status-modal');
        const statusModalBackdrop = document.getElementById('status-modal-backdrop');
        const statusModalContent = document.getElementById('status-modal-content');

        window.openStatusModal = function(id) {
            eventToEditStatusId = id;
            statusModal.classList.remove('hidden');
            setTimeout(() => {
                statusModalBackdrop.classList.remove('opacity-0');
                statusModalContent.classList.remove('scale-90', 'opacity-0');
                statusModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.closeStatusModal = function() {
            statusModalBackdrop.classList.add('opacity-0');
            statusModalContent.classList.remove('scale-100', 'opacity-100');
            statusModalContent.classList.add('scale-90', 'opacity-0');
            setTimeout(() => {
                statusModal.classList.add('hidden');
                eventToEditStatusId = null;
            }, 300);
        }

        window.updateStatus = function(newStatus) {
            if (eventToEditStatusId) {
                const eventIndex = events.findIndex(e => e.id === eventToEditStatusId);
                if (eventIndex > -1) {
                    events[eventIndex].status = newStatus;
                    saveEvents();
                    renderContent();
                    renderStats();
                }
                closeStatusModal();
            }
        }

    </script>
</body>
</html>